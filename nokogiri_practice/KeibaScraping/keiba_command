require 'thor'
require './race_scraper.rb'
require './csv_generator.rb'

class KeibaCommand < Thor

  desc 'getrace place("tokyo" or "kyoto" or "fukushima"), race_number', 'return racedata from racepage'
  option :csv
  def getrace(place, race_number)
    race_scraper = RaceScraper.new
    race = race_scraper.scrape_race(place, race_number)
    display_race_data(race)
    if options[:csv]
      csv_generator = CSVGenerator.new
      csv_generator.generate_race_csv(race)
      puts 'csv created!!'
    end
  end

  desc 'getraces raceplace', 'return 10 about racedata from racelistpage'
  option :csv
  def getraces(place)
    race_scraper = RaceScraper.new
    races = race_scraper.scrape_race_from_list(place)
    races.each {|race|
      display_race_data(race)
    }
    if options[:csv]
      csv_generator = CSVGenerator.new
      csv_generator.generate_races_csv(races)
      puts 'csv created!!'
    end
  end

  no_commands do
    def display_race_data(race)
      puts race.place
      puts race.num
      puts race.name
      puts %w('着順', '馬番', '名前', '騎手名', '人気', 'オッズ').join('  ')
      race.result.each do |horce|
        horce_array = [
          horce.ranking,
          horce.number, 
          horce.name, 
          horce.jockey, 
          horce.popularity, 
          horce.odds
        ]
        puts ((horce_array).join('  '))
      end
    end
  end

end

KeibaCommand.start(ARGV)